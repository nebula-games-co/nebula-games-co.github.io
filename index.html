<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Audio Externo para Juego Rítmico</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 90%;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #1e1e1e;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        h1 {
            color: #7289da;
            margin-bottom: 0.5rem;
        }
        .connection-section {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .code-display {
            font-size: 2.5rem;
            letter-spacing: 0.5rem;
            text-align: center;
            font-weight: bold;
            color: #43b581;
            margin: 1.5rem 0;
        }
        .status {
            text-align: center;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-weight: bold;
        }
        .disconnected {
            background-color: #f04747;
            color: white;
        }
        .connected {
            background-color: #43b581;
            color: white;
            display: none;
        }
        .audio-status {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        .audio-player {
            background-color: #3d3d3d;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: none;
        }
        .now-playing {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .player-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        button {
            background-color: #7289da;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #5c6fb1;
        }
        .song-list {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 1.5rem;
        }
        .song-item {
            background-color: #3d3d3d;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .song-info {
            flex-grow: 1;
        }
        .song-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        .song-artist {
            font-size: 0.9rem;
            color: #b9bbbe;
        }
        footer {
            text-align: center;
            margin-top: 2rem;
            color: #b9bbbe;
            font-size: 0.9rem;
            padding: 1rem;
        }
        .instructions {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        .log-container {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            font-family: 'Courier New', monospace;
            margin-bottom: 0.5rem;
            word-break: break-all;
        }
        .log-info {
            color: #7289da;
        }
        .log-success {
            color: #43b581;
        }
        .log-error {
            color: #f04747;
        }
        .audio-progress {
            width: 100%;
            height: 6px;
            background-color: #4d4d4d;
            border-radius: 3px;
            margin: 1rem 0;
            position: relative;
            cursor: pointer;
        }
        .progress-bar {
            height: 100%;
            background-color: #7289da;
            border-radius: 3px;
            width: 0%;
        }
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #b9bbbe;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Reproductor de Audio Externo</h1>
            <p>Conecta tu juego de Roblox para reproducir audio sin problemas de copyright</p>
        </header>

        <div class="connection-section">
            <h2>Conecta tu juego</h2>
            <p>Ingresa este código en tu juego de ritmo en Roblox:</p>
            <div class="code-display" id="connectionCode">------</div>
            <div class="status disconnected" id="statusDisconnected">Desconectado</div>
            <div class="status connected" id="statusConnected">Conectado</div>
            <button id="generateCode">Generar Nuevo Código</button>
        </div>

        <div class="audio-status" id="audioStatus">
            <h2>Estado de Reproducción</h2>
            <p id="waitingMessage">Esperando solicitudes de audio desde Roblox...</p>
        </div>

        <div class="audio-player" id="audioPlayer">
            <div class="now-playing" id="nowPlaying">Reproduciendo: Nombre de la canción</div>
            <div class="audio-progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="totalTime">0:00</span>
            </div>
            <div class="player-controls">
                <button id="playPauseBtn">Pausa</button>
                <button id="stopBtn">Detener</button>
                <button id="volumeBtn">Volumen: 100%</button>
            </div>
        </div>

        <div class="instructions">
            <h2>Instrucciones</h2>
            <p><strong>Importante: Esta página ahora funciona en modo local (sin backend real).</strong></p>
            <ol>
                <li>Genera un código de conexión haciendo clic en el botón "Generar Nuevo Código"</li>
                <li>Abre tu juego de ritmo en Roblox e introduce el código cuando se solicite</li>
                <li>Una vez conectado, tu juego podrá enviar solicitudes para reproducir audio en esta página</li>
                <li>Los audios en el juego ahora funcionan directamente de Roblox, pero esta interfaz te permite:
                    <ul>
                        <li>Probar las canciones antes de jugar</li>
                        <li>Controlar el volumen externamente</li>
                        <li>Simular la experiencia del sistema de audio externo</li>
                    </ul>
                </li>
                <li>Mantén esta página abierta mientras juegas para consultar información</li>
            </ol>
            <p><strong>Nota:</strong> El código generado en esta página debe coincidir con el que introduzcas en el juego.</p>
        </div>

        <div class="song-list">
            <h2>Biblioteca de Canciones</h2>
            <div id="songContainer">
                <!-- Las canciones se cargarán aquí dinámicamente -->
            </div>
        </div>

        <div class="log-container" id="logContainer">
            <!-- Los registros de actividad se mostrarán aquí -->
        </div>
    </div>

    <footer>
        <p>Este servicio simula un reproductor de audio externo. En una versión completa, esto evitaría problemas de copyright en Roblox.</p>
    </footer>

    <audio id="audioElement" style="display: none;"></audio>

    <script>
        // Variables para almacenar información de conexión
        let connectionActive = false;
        let currentCode = null;
        let sessionToken = null;
        let currentSong = null;
        let audioElement = document.getElementById('audioElement');
        
        // Elementos DOM
        const codeDisplay = document.getElementById('connectionCode');
        const generateBtn = document.getElementById('generateCode');
        const statusConnected = document.getElementById('statusConnected');
        const statusDisconnected = document.getElementById('statusDisconnected');
        const songContainer = document.getElementById('songContainer');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioStatus = document.getElementById('audioStatus');
        const waitingMessage = document.getElementById('waitingMessage');
        const nowPlaying = document.getElementById('nowPlaying');
        const logContainer = document.getElementById('logContainer');
        const progressBar = document.getElementById('progressBar');
        const currentTimeDisplay = document.getElementById('currentTime');
        const totalTimeDisplay = document.getElementById('totalTime');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const volumeBtn = document.getElementById('volumeBtn');

        // Biblioteca de canciones disponibles
        const songLibrary = [
            { id: '1', title: 'Loli Bomb x1.00', artist: 'Slax', file: 'audio/song1.mp3' },
            { id: '2', title: 'Loli Bomb x1.05', artist: 'Slax', file: 'audio/song2.mp3' },
            { id: '3', title: 'Loli Bomb x1.10', artist: 'Slax', file: 'audio/song3.mp3' },
            { id: '4', title: 'Loli Bomb x1.20', artist: 'Slax', file: 'audio/song4.mp3' },
            { id: '5', title: 'Loli Bomb x1.30', artist: 'Slax', file: 'audio/song5.mp3' },
            { id: '6', title: 'Loli Bomb x1.40', artist: 'Slax', file: 'audio/song6.mp3' }
        ];

        // Generar código aleatorio de 6 dígitos
        function generateRandomCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Actualizar la interfaz cuando se conecta
        function updateConnectionUI(connected) {
            connectionActive = connected;
            statusConnected.style.display = connected ? 'block' : 'none';
            statusDisconnected.style.display = connected ? 'none' : 'block';
            
            if (connected) {
                loadSongList();
                addLogEntry('Código generado correctamente. Úsalo en tu juego de Roblox.', 'success');
            } else {
                songContainer.innerHTML = `
                    <div class="song-item">
                        <div class="song-info">
                            <div class="song-title">Conéctate para ver las canciones disponibles</div>
                            <div class="song-artist">Necesitas un código de conexión activo</div>
                        </div>
                    </div>
                `;
            }
        }

        // Cargar lista de canciones
        function loadSongList() {
            let songsHTML = '';
            songLibrary.forEach(song => {
                songsHTML += `
                    <div class="song-item" data-song-id="${song.id}">
                        <div class="song-info">
                            <div class="song-title">${song.title}</div>
                            <div class="song-artist">${song.artist}</div>
                        </div>
                        <button class="test-play-btn" data-song-id="${song.id}">Probar</button>
                    </div>
                `;
            });
            
            songContainer.innerHTML = songsHTML;
            
            // Agregar event listeners para los botones de prueba
            document.querySelectorAll('.test-play-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const songId = this.getAttribute('data-song-id');
                    playSong(songId);
                });
            });
        }

        // Función para reproducir una canción
        function playSong(songId) {
            const song = songLibrary.find(s => s.id === songId);
            if (!song) {
                addLogEntry(`Canción con ID "${songId}" no encontrada`, 'error');
                return;
            }
            
            currentSong = song;
            
            // En una implementación real, aquí cargaríamos el archivo
            // Para esta demo, simulamos la reproducción
            addLogEntry(`Simulando reproducción: "${song.title}" por ${song.artist}`, 'success');
            
            // Actualizar UI
            audioStatus.style.display = 'none';
            audioPlayer.style.display = 'block';
            nowPlaying.textContent = `Reproduciendo: ${song.title} - ${song.artist}`;
            
            // Simulamos una duración
            let duration = 180; // 3 minutos en segundos
            let currentTime = 0;
            totalTimeDisplay.textContent = formatTime(duration);
            
            // Simulamos una reproducción con intervalos
            if (window.playInterval) {
                clearInterval(window.playInterval);
            }
            
            window.playInterval = setInterval(() => {
                currentTime += 1;
                if (currentTime >= duration) {
                    clearInterval(window.playInterval);
                    resetPlayer();
                    return;
                }
                
                // Actualizar UI
                const progress = (currentTime / duration) * 100;
                progressBar.style.width = `${progress}%`;
                currentTimeDisplay.textContent = formatTime(currentTime);
            }, 1000);
        }

        // Formatear tiempo en formato mm:ss
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Resetear el reproductor
        function resetPlayer() {
            if (window.playInterval) {
                clearInterval(window.playInterval);
            }
            
            currentSong = null;
            
            // Actualizar UI
            audioPlayer.style.display = 'none';
            audioStatus.style.display = 'block';
            progressBar.style.width = '0%';
            currentTimeDisplay.textContent = '0:00';
            totalTimeDisplay.textContent = '0:00';
        }

        // Control de reproducción
        playPauseBtn.addEventListener('click', function() {
            if (!window.isPaused) {
                window.isPaused = true;
                playPauseBtn.textContent = 'Reproducir';
                if (window.playInterval) {
                    clearInterval(window.playInterval);
                    window.pausedTime = parseInt(currentTimeDisplay.textContent.split(':')[0]) * 60 + 
                                        parseInt(currentTimeDisplay.textContent.split(':')[1]);
                }
            } else {
                window.isPaused = false;
                playPauseBtn.textContent = 'Pausa';
                
                // Reiniciar la simulación desde donde se quedó
                if (currentSong) {
                    let duration = 180;
                    let currentTime = window.pausedTime || 0;
                    
                    window.playInterval = setInterval(() => {
                        currentTime += 1;
                        if (currentTime >= duration) {
                            clearInterval(window.playInterval);
                            resetPlayer();
                            return;
                        }
                        
                        // Actualizar UI
                        const progress = (currentTime / duration) * 100;
                        progressBar.style.width = `${progress}%`;
                        currentTimeDisplay.textContent = formatTime(currentTime);
                    }, 1000);
                }
            }
        });

        stopBtn.addEventListener('click', function() {
            resetPlayer();
        });

        // Control de volumen (simple toggle por ahora)
        let volumeLevel = 1.0;
        volumeBtn.addEventListener('click', function() {
            if (volumeLevel > 0.5) {
                volumeLevel = 0.5;
            } else if (volumeLevel > 0) {
                volumeLevel = 0;
            } else {
                volumeLevel = 1.0;
            }
            
            volumeBtn.textContent = `Volumen: ${Math.round(volumeLevel * 100)}%`;
        });

        // Agregar entradas al registro
        function addLogEntry(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logContainer.appendChild(entry);
            
            // Auto-scroll al fondo
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Generar nuevo código de conexión
        generateBtn.addEventListener('click', function() {
            currentCode = generateRandomCode();
            sessionToken = "token-" + currentCode; // Simular token
            codeDisplay.textContent = currentCode;
            
            // Simulamos éxito inmediato
            updateConnectionUI(true);
            addLogEntry(`Nuevo código generado: ${currentCode}. Úsalo en tu juego de Roblox.`, 'info');
        });

        // Para propósitos de demostración, inicializamos con UI desconectada
        updateConnectionUI(false);
        addLogEntry('Sistema inicializado. Haz clic en "Generar Nuevo Código" para comenzar.', 'info');
        
        // Generar un código inicial automáticamente
        setTimeout(() => {
            generateBtn.click();
        }, 1000);
    </script>
</body>
</html>
